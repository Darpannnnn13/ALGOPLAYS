<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Edit AI Explanations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; }
        .title-font { font-family: 'Orbitron', sans-serif; }
        label { font-weight: bold; color: #9CA3AF; }
        input[type="text"], textarea {
            background-color: #1F2937; border: 1px solid #4B5563;
            border-radius: 0.375rem; padding: 0.5rem 0.75rem;
            width: 100%; color: #E5E7EB;
        }
        textarea { resize: vertical; }
        .ai-select-btn.active {
            background-color: #10B981;
            color: #111827;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gray-900 text-white p-6">
    <h1 class="text-3xl font-bold text-green-400 mb-4 title-font">Edit AI Explanations</h1>

    <div class="mb-6">
        <a href="{{ url_for('admin_games') }}" class="px-4 py-2 bg-blue-600 rounded hover:bg-blue-500 transition-colors">&larr; Back to Game Management</a>
    </div>

    <!-- AI Selector Buttons -->
    <div id="ai-selector" class="flex flex-wrap gap-2 mb-8 border-b border-gray-700 pb-4">
        {% for game, algos in explanations.items() %}
            {% for algo, details in algos.items() %}
                <button type="button" class="ai-select-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600 transition-colors" data-target="form-{{ game }}-{{ algo }}">
                    {{ details.name }}
                </button>
            {% endfor %}
        {% endfor %}
    </div>

    <form method="POST" action="{{ url_for('admin_edit_explanations') }}">
        <!-- Edit Existing Explanations Container -->
        <div id="forms-container">
            {% for game, algos in explanations.items() %}
                {% for algo, details in algos.items() %}
                <div id="form-{{ game }}-{{ algo }}" class="ai-form-container hidden space-y-4 mb-8 p-4 border border-gray-700 rounded-md bg-gray-800">
                    <h3 class="text-2xl font-semibold text-yellow-400">{{ details.name }} for {{ GAME_NAMES.get(game, game) }}</h3>
                    <p class="text-sm text-gray-500">Internal Key: <code>{{ game }}_{{ algo }}</code></p>
                    
                    <div>
                        <label for="{{ game }}_{{ algo }}_name">Name</label>
                        <input type="text" id="{{ game }}_{{ algo }}_name" name="{{ game }}_{{ algo }}_name" value="{{ details.name }}">
                    </div>
                    <div>
                        <label for="{{ game }}_{{ algo }}_description">Description</label>
                        <textarea id="{{ game }}_{{ algo }}_description" name="{{ game }}_{{ algo }}_description" rows="3">{{ details.description }}</textarea>
                    </div>
                    <div>
                        <label for="{{ game }}_{{ algo }}_analogy">Analogy</label>
                        <textarea id="{{ game }}_{{ algo }}_analogy" name="{{ game }}_{{ algo }}_analogy" rows="2">{{ details.analogy }}</textarea>
                    </div>
                    <div>
                        <label for="{{ game }}_{{ algo }}_how_it_works">How It Works (one point per line)</label>
                        <textarea id="{{ game }}_{{ algo }}_how_it_works" name="{{ game }}_{{ algo }}_how_it_works" rows="4">{{ '\n'.join(details.how_it_works) }}</textarea>
                    </div>
                    <div>
                        <label for="{{ game }}_{{ algo }}_advantages">Advantages (one point per line)</label>
                        <textarea id="{{ game }}_{{ algo }}_advantages" name="{{ game }}_{{ algo }}_advantages" rows="3">{{ '\n'.join(details.advantages) }}</textarea>
                    </div>
                    <div>
                        <label for="{{ game }}_{{ algo }}_disadvantages">Disadvantages (one point per line)</label>
                        <textarea id="{{ game }}_{{ algo }}_disadvantages" name="{{ game }}_{{ algo }}_disadvantages" rows="3">{{ '\n'.join(details.disadvantages) }}</textarea>
                    </div>
                </div>
                {% endfor %}
            {% endfor %}
        </div>
        
        <!-- Add New Explanation (Always Visible) -->
        <div class="bg-gray-800 p-6 rounded-lg mt-12">
             <h2 class="text-2xl text-cyan-400 mb-4 border-b border-gray-700 pb-2">Add New AI Explanation</h2>
             <div class="space-y-4">
                <div>
                    <label for="new_game_key">Game Key (e.g., 'maze')</label>
                    <input type="text" id="new_game_key" name="new_game_key" placeholder="Internal game name, like 'word_search'">
                </div>
                 <div>
                    <label for="new_algo_key">Algorithm Key (e.g., 'bfs')</label>
                    <input type="text" id="new_algo_key" name="new_algo_key" placeholder="Internal algorithm name, like 'dijkstra'">
                </div>
                <div>
                    <label for="new_name">Name</label>
                    <input type="text" id="new_name" name="new_name" placeholder="Dijkstra's Algorithm">
                </div>
                <div>
                    <label for="new_description">Description</label>
                    <textarea id="new_description" name="new_description" rows="3"></textarea>
                </div>
                 <div>
                    <label for="new_analogy">Analogy</label>
                    <textarea id="new_analogy" name="new_analogy" rows="2"></textarea>
                </div>
                 <div>
                    <label for="new_how_it_works">How It Works (one point per line)</label>
                    <textarea id="new_how_it_works" name="new_how_it_works" rows="4"></textarea>
                </div>
                <div>
                    <label for="new_advantages">Advantages (one point per line)</label>
                    <textarea id="new_advantages" name="new_advantages" rows="3"></textarea>
                </div>
                <div>
                    <label for="new_disadvantages">Disadvantages (one point per line)</label>
                    <textarea id="new_disadvantages" name="new_disadvantages" rows="3"></textarea>
                </div>
             </div>
        </div>

        <button type="submit" class="mt-8 px-8 py-3 bg-green-500 text-black rounded font-bold hover:bg-green-400 text-lg">Save All Changes</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const selector = document.getElementById('ai-selector');
            const formsContainer = document.getElementById('forms-container');
            const buttons = Array.from(selector.getElementsByClassName('ai-select-btn'));
            const forms = Array.from(formsContainer.getElementsByClassName('ai-form-container'));

            selector.addEventListener('click', (e) => {
                const targetButton = e.target.closest('.ai-select-btn');
                if (!targetButton) return;
                
                const targetId = targetButton.dataset.target;

                // Toggle visibility for forms
                forms.forEach(form => {
                    if (form.id === targetId) {
                        form.classList.remove('hidden');
                    } else {
                        form.classList.add('hidden');
                    }
                });

                // Toggle active state for buttons
                buttons.forEach(button => {
                    if (button === targetButton) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
            });

            // Show the first AI by default
            if (buttons.length > 0) {
                buttons[0].click();
            }
        });
    </script>
</body>
</html>

