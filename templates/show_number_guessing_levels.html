<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Number Guessing Levels</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body class="bg-gray-900 text-white p-10 min-h-screen flex flex-col">

    <h1 class="text-4xl mb-10 font-bold text-green-400">Select a Level</h1>
    <div id="levelsContainer" class="grid grid-cols-2 md:grid-cols-5 gap-6 flex-grow"></div>
    <div class="mt-10">
        <a href="/number_guessing" class="inline-block px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded text-white font-semibold transition">
            ‚¨ÖÔ∏è Back to Number Guessing
        </a>
    </div>

    <script>
        const playedLevels = {{ played_levels | tojson | safe }};
        const difficulties = ['easy', 'medium', 'hard'];
        const colors = {
            easy: 'bg-green-500 hover:bg-green-400',
            medium: 'bg-yellow-500 hover:bg-yellow-400',
            hard: 'bg-red-500 hover:bg-red-400',
        };
        const container = document.getElementById('levelsContainer');

        difficulties.forEach(diff => {
            for (let i = 1; i <= 5; i++) {
                const key = `number_guessing_${diff}-${i}`;
                const data = playedLevels[key]; // This gets the JSON object for the level
                // Consider a level "played" if any of the players (human or AIs) has data
                const isPlayed = !!data && (
                    data.hasOwnProperty('human_guesses') ||
                    data.hasOwnProperty('greedy_guesses') ||
                    data.hasOwnProperty('dfs_guesses')
                );

                let statsHtml = '';
                if (data) {
                    // This section reads the 'human_guesses' and 'human_time' keys
                    // Use hasOwnProperty so that zero guesses (0) still show
                    if (data.hasOwnProperty('human_guesses')) {
                        const timeText = (data.human_time !== undefined && data.human_time !== null && data.human_time !== '') ? ` (${data.human_time})` : '';
                        statsHtml += `<div class="text-xs text-black bg-white/40 rounded px-2 py-0.5 mb-1">üßç You: ${data.human_guesses} guesses${timeText}</div>`;
                    }
                    // This section reads the 'greedy_guesses' and 'greedy_time' keys
                    if (data.hasOwnProperty('greedy_guesses')) {
                        const timeText = (data.greedy_time !== undefined && data.greedy_time !== null && data.greedy_time !== '') ? ` (${parseFloat(data.greedy_time).toFixed(7)}s)` : '';
                        statsHtml += `<div class="text-xs bg-white/40 rounded px-2 py-0.5 mb-1" style="color: #4f46e5;">ü§ñ Greedy: ${data.greedy_guesses} guesses${timeText}</div>`;
                    }
                    // This section reads the 'dfs_guesses' and 'dfs_time' keys
                    if (data.hasOwnProperty('dfs_guesses')) {
                        const timeText = (data.dfs_time !== undefined && data.dfs_time !== null && data.dfs_time !== '') ? ` (${parseFloat(data.dfs_time).toFixed(7)}s)` : '';
                        statsHtml += `<div class="text-xs bg-white/40 rounded px-2 py-0.5 mb-1" style="color: #be123c;">ü§ñ DFS: ${data.dfs_guesses} guesses${timeText}</div>`;
                    }
                }

                const link = document.createElement('a');
                link.href = `/level/number_guessing/${diff}/${i}`;
                link.className = `flex flex-col items-center justify-center p-4 rounded-lg ${colors[diff]} text-black font-semibold transition`;

                link.innerHTML = `
                  <span class="text-lg font-bold">${diff.toUpperCase()} Level ${i}</span>
                  ${isPlayed ? `<i class="fas fa-star text-black text-xl mt-2"></i>` : `<i class="far fa-star text-black text-xl mt-2"></i>`}
                  <div class="flex flex-col items-start mt-2 w-full pl-2">${statsHtml}</div>
                `;
                container.appendChild(link);
            }
        });
    </script>
</body>
</html>