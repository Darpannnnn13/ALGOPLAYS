<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Algorithm Explanation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400&display=swap" rel="stylesheet">
    <style>
        body { background-color: transparent; font-family: 'Roboto', sans-serif; }
        .title-font { font-family: 'Orbitron', sans-serif; }
        .star-field {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0C0A1A;
            overflow: hidden;
            z-index: -1;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle linear infinite;
        }
        @keyframes twinkle {
            0%, 100% { transform: scale(0.5); opacity: 0.5; }
            50% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    
    <div id="star-field" class="star-field"></div>

    <div id="content" class="relative z-10 max-w-4xl mx-auto p-10 opacity-0 transition-opacity duration-500 bg-gray-900/50 backdrop-blur-sm rounded-lg mt-10 border border-green-500/20">
        </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const gameKey = params.get('game');
            const algoKey = params.get('algo');
            const contentEl = document.getElementById('content');

            // Starfield Generation
            const starField = document.getElementById('star-field');
            if (!starField.hasChildNodes()) {
                for (let i = 0; i < 200; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    const size = Math.random() * 3;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.animationDuration = `${2 + Math.random() * 3}s`;
                    star.style.animationDelay = `${Math.random() * 5}s`;
                    starField.appendChild(star);
                }
            }

            if (!gameKey || !algoKey) {
                contentEl.innerHTML = `<h1 class="text-4xl font-bold text-red-500 title-font">Error</h1><p class="text-lg mt-4">No game or algorithm specified in the URL.</p>`;
                contentEl.style.opacity = 1;
                return;
            }

            fetch('/api/explanations')
                .then(response => response.json())
                .then(data => {
                    const info = data[gameKey] ? data[gameKey][algoKey] : null;

                    if (!info) {
                        contentEl.innerHTML = `<h1 class="text-4xl font-bold text-red-500 title-font">Error</h1><p class="text-lg mt-4">Explanation for "${gameKey} - ${algoKey}" not found.</p>`;
                        contentEl.style.opacity = 1;
                        return;
                    }
                    
                    const gameTitle = gameKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    document.title = `How ${info.name} Works`;

                    const createList = (items) => items.map(item => `<li class="mb-2">${item}</li>`).join('');

                    // Build new sections for detailed info
                    let analogyHtml = '';
                    if (info.analogy) {
                        analogyHtml = `
                            <div class="mt-8">
                                <h2 class="text-2xl font-semibold text-green-400 border-b border-green-400/30 pb-2 mb-3">Analogy</h2>
                                <p class="text-gray-300 leading-relaxed italic">"${info.analogy}"</p>
                            </div>
                        `;
                    }
                    
                    let complexityHtml = '';
                    if (info.time_complexity || info.space_complexity) {
                        complexityHtml = `
                            <div class="mt-8">
                                <h2 class="text-2xl font-semibold text-green-400 border-b border-green-400/30 pb-2 mb-3">Technical Details</h2>
                                <div class="bg-gray-800/50 p-4 rounded-lg space-y-2">
                                    ${info.core_mechanism ? `<p><strong class="text-green-300 w-40 inline-block">Core Mechanism:</strong> ${info.core_mechanism}</p>` : ''}
                                    ${info.time_complexity ? `<p><strong class="text-green-300 w-40 inline-block">Time Complexity:</strong> <code class="text-yellow-300 font-mono">${info.time_complexity}</code></p>` : ''}
                                    ${info.space_complexity ? `<p><strong class="text-green-300 w-40 inline-block">Space Complexity:</strong> <code class="text-yellow-300 font-mono">${info.space_complexity}</code></p>` : ''}
                                </div>
                            </div>
                        `;
                    }

                    // Assemble final HTML
                    const html = `
                        <h1 class="text-4xl font-bold text-green-400 mb-4 title-font">
                            How does <span class="text-white">${info.name}</span> work in <span class="text-white">${gameTitle}</span>?
                        </h1>
                        <p class="text-lg leading-relaxed text-gray-300">${info.description}</p>
                        
                        ${analogyHtml}

                        <div class="mt-8">
                            <h2 class="text-2xl font-semibold text-green-400 border-b border-green-400/30 pb-2 mb-3">How It Works in This Game</h2>
                            <ul class="list-disc list-inside text-gray-300 space-y-2">${createList(info.how_it_works)}</ul>
                        </div>

                        ${complexityHtml}

                        <div class="grid md:grid-cols-2 gap-8 mt-8">
                            <div>
                                <h2 class="text-2xl font-semibold text-green-400 border-b border-green-400/30 pb-2 mb-3">✅ Advantages</h2>
                                <ul class="list-disc list-inside text-gray-300 space-y-2">${createList(info.advantages)}</ul>
                            </div>
                            <div>
                                <h2 class="text-2xl font-semibold text-red-400 border-b border-red-400/30 pb-2 mb-3">❌ Disadvantages</h2>
                                <ul class="list-disc list-inside text-gray-300 space-y-2">${createList(info.disadvantages)}</ul>
                            </div>
                        </div>

                        <div class="mt-10 flex justify-center">
                            <button onclick="window.close()" class="px-6 py-2 bg-green-500 text-black rounded font-bold hover:bg-green-400 transition">
                                Close Tab
                            </button>
                        </div>
                    `;

                    contentEl.innerHTML = html;
                    contentEl.style.opacity = 1;
                })
                .catch(error => {
                    console.error("Failed to fetch explanations:", error);
                    contentEl.innerHTML = `<h1 class="text-4xl font-bold text-red-500">Error</h1><p class="text-lg mt-4">Could not load explanation data.</p>`;
                    contentEl.style.opacity = 1;
                });
        });
    </script>
</body>
</html>